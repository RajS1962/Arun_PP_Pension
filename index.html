<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Firebase: Add these scripts FIRST (before any of your own scripts) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script>
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDt90LIpScfZDdWD8NcUAY0pfGuM1x03tQ",
      authDomain: "arun-pp-pension.firebaseapp.com",
      projectId: "arun-pp-pension",
      storageBucket: "arun-pp-pension.firebasestorage.app",
      messagingSenderId: "1079148979168",
      appId: "1:1079148979168:web:7fa09423f6a835fee9c185",
      measurementId: "G-43ZJK7WGGG"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    if ('measurementId' in firebaseConfig) {
      firebase.analytics();
    }
    // Use firebase.firestore() for database commands later
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Pension Dashboard</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(120deg, #212033 0%, #2a144c 100%);
      margin: 0;
      color: #e7e4f5;
    }
    header {
      background: #271953;
      color: #e7e4f5;
      padding: 1.2em 0;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 2px 14px #221345aa;
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 1.4em;
      background: #181828;
      box-shadow: 0 2px 8px rgba(80,56,150,0.09);
      font-size: 1.1em;
      font-weight: 700;
      flex-wrap: wrap;
    }
    nav button {
      background: none;
      border: none;
      color: #ac8fff;
      cursor: pointer;
      padding: 1em 0.7em;
      transition: color 0.2s;
    }
    nav button.active,
    nav button:hover {
      color: #ffeeee;
      text-shadow: 0 0 8px #965cff55;
      text-decoration: underline;
    }
    main {
      max-width: 900px;
      margin: 2em auto;
      padding: 2em;
      background: #19182c;
      border-radius: 20px;
      box-shadow: 0 4px 24px #2a144c40;
    }
    .stats { 
      display: flex; 
      gap: 2em; 
      flex-wrap: wrap; 
      margin-bottom: 2em; 
    }
    .statbox { 
      background: linear-gradient(120deg, #271953 60%, #454566 100%);
      border-radius: 11px;
      padding: 1.2em 2em;
      box-shadow: 0 2px 8px #46208322;
      color: #f3d8ff;
      flex: 1;
      min-width: 200px;
    }
    .form-row { 
      display: flex; 
      gap: 1em; 
      align-items: center; 
      margin-bottom: 0.5em; 
    }
    label { 
      min-width: 70px; 
      font-weight: 500;
    }
    input[type='number'] {
      width: 100px;
      padding: 0.5em;
      border-radius: 5px;
      border: 1px solid #7d48ce;
      background: #252145;
      color: #ac8fff;
      font-size: 1em;
    }
    .savebtn {
      background: #6c3cc7;
      color: #fff;
      border: none;
      padding: 0.7em 1.2em;
      border-radius: 7px;
      cursor: pointer;
      font-weight: 700;
      transition: background 0.17s;
      margin-top: 0.8em;
      margin-right: 0.5em;
    }
    .savebtn:hover { 
      background: #a679f7; 
      color: #271953;
    }
    table { 
      width: 100%; 
      background: #22134546; 
      margin-top: 1.5em; 
      border-radius: 8px; 
      border-collapse: collapse;
      overflow: hidden;
    }
    th, td { 
      padding: 0.8em 0.5em; 
      text-align: center; 
      border-bottom: 1px solid #27195333;
    }
    th {
      background: #271953;
      font-weight: 700;
      color: #21d4fd;
    }
    td {
      color: #e7e4f5;
    }
    tr:last-child td {
      border-bottom: none;
    }
    @media (max-width:600px) {
      main { 
        padding: 1em; 
        margin: 1em;
      }
      .stats { 
        flex-direction: column; 
        gap: 1em; 
      }
      table { 
        font-size: 0.85em; 
      }
      th, td {
        padding: 0.5em 0.3em;
      }
      input[type='number'] {
        width: 80px;
      }
    }
  </style>
</head>
<body>
  <header>Pension Dashboard</header>
  <nav id="tabs"></nav>
  <main id="content"></main>
  <script>
    // Default pension data structure
    const DEFAULT_DATA = {
      Nest: { 
        provider: 'Nest', 
        values: {2018: 1000, 2019: 1300, 2020: 1400, 2021: 1500, 2022: 1600, 2023: 1800, 2024: 2000} 
      },
      'Royal London': { 
        provider: 'Royal London', 
        values: {2018: 0, 2019: 0, 2020: 0, 2021: 1200, 2022: 2600, 2023: 3300, 2024: 4500} 
      },
      Baringa: { 
        provider: 'Baringa', 
        values: {2018: 0, 2019: 0, 2020: 0, 2021: 0, 2022: 0, 2023: 0, 2024: 2500} 
      }
    };

    // Load data from localStorage or use defaults
    let pensionData = JSON.parse(localStorage.getItem('pensionDataV2') || JSON.stringify(DEFAULT_DATA));
    let activeTab = 'Dashboard';
    let chartInstances = {};

    function getAllYears() {
      const yearSet = new Set();
      Object.values(pensionData).forEach(pension => {
        Object.keys(pension.values).forEach(year => {
          yearSet.add(parseInt(year));
        });
      });
      return Array.from(yearSet).sort((a, b) => a - b);
    }

    function calculateTotals(years) {
      const totals = {};
      years.forEach(year => {
        totals[year] = Object.values(pensionData).reduce((sum, pension) => {
          return sum + (pension.values[year] || 0);
        }, 0);
      });
      return totals;
    }

    function renderTabs() {
      const tabs = ['Dashboard', ...Object.keys(pensionData)];
      document.getElementById('tabs').innerHTML = tabs.map(tab =>
        `<button class="${activeTab === tab ? 'active' : ''}" onclick="switchTab('${tab}')">${tab}</button>`
      ).join('');
    }

    window.switchTab = function(tab) {
      activeTab = tab;
      render();
    };

    function drawLineChart(canvasId, labels, data, label, color = '#21d4fd') {
      if (chartInstances[canvasId]) {
        chartInstances[canvasId].destroy();
      }

      const ctx = document.getElementById(canvasId).getContext('2d');
      chartInstances[canvasId] = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: label,
            data: data,
            fill: true,
            tension: 0.33,
            borderColor: color,
            backgroundColor: `${color}30`,
            pointRadius: 5,
            pointBackgroundColor: '#fad0c4',
            pointBorderColor: color,
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { display: false } },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { color: '#ac8fff', callback: value => '£' + value.toLocaleString() },
              grid: { color: '#27195333' }
            },
            x: {
              ticks: { color: '#ac8fff' },
              grid: { color: '#27195333' }
            }
          }
        }
      });
    }

    function render() {
      renderTabs();
      const content = document.getElementById('content');
      const years = getAllYears();

      if (activeTab === 'Dashboard') {
        renderDashboard(content, years);
      } else {
        renderPensionTab(content, years);
      }
    }

    function renderDashboard(content, years) {
      const totals = calculateTotals(years);
      const latestYear = years[years.length - 1];
      const previousYear = years[years.length - 2];
      const currentTotal = totals[latestYear] || 0;
      const previousTotal = totals[previousYear] || 0;
      const growth = currentTotal - previousTotal;

      content.innerHTML = `
        <div class="stats">
          <div class="statbox">
            <div><b>Total Pension Value (${latestYear}):</b></div>
            <div style="font-size:1.8em;margin-top:0.3em;">£${currentTotal.toLocaleString()}</div>
          </div>
          <div class="statbox">
            <div><b>Year-on-Year Growth:</b></div>
            <div style="font-size:1.4em;margin-top:0.3em;color:${growth >= 0 ? '#6ee7b7' : '#fca5a5'}">
              ${growth >= 0 ? '+' : ''}£${growth.toLocaleString()}
            </div>
          </div>
        </div>
        <h3 style="color:#21d4fd;margin-bottom:0.5em;">Combined Pension Value Over Time</h3>
        <canvas id="dashboardChart" style="max-height:300px;"></canvas>
        <h3 style="color:#21d4fd;margin-top:2em;margin-bottom:0.5em;">Yearly Values</h3>
        <table>
          <thead>
            <tr>${years.map(y => `<th>${y}</th>`).join('')}</tr>
          </thead>
          <tbody>
            <tr>${years.map(y => `<td>£${(totals[y] || 0).toLocaleString()}</td>`).join('')}</tr>
          </tbody>
        </table>
      `;

      setTimeout(() => {
        drawLineChart('dashboardChart', years, years.map(y => totals[y] || 0), 'Total Value (£)');
      }, 50);
    }

    function renderPensionTab(content, years) {
      const pension = pensionData[activeTab];
      content.innerHTML = `
        <h3 style="color:#21d4fd;margin-bottom:1em;">Edit Values for ${activeTab}</h3>
        <form id="editForm">
          ${years.map(year => `
            <div class="form-row">
              <label>${year}:</label>
              <input type="number" min="0" step="100" name="val-${year}" value="${pension.values[year] || 0}" />
            </div>
          `).join('')}
          <div style="margin-top:1em;">
            <button type="submit" class="savebtn">Save Changes</button>
            <button type="button" class="savebtn" id="addYearBtn">Add New Year</button>
          </div>
        </form>
        <h3 style="color:#21d4fd;margin-top:2em;margin-bottom:0.5em;">${activeTab} Value Over Time</h3>
        <canvas id="pensionChart" style="max-height:300px;"></canvas>
        <h3 style="color:#21d4fd;margin-top:2em;margin-bottom:0.5em;">Yearly Values</h3>
        <table>
          <thead>
            <tr>${years.map(y => `<th>${y}</th>`).join('')}</tr>
          </thead>
          <tbody>
            <tr>${years.map(y => `<td>£${(pension.values[y] || 0).toLocaleString()}</td>`).join('')}</tr>
          </tbody>
        </table>
      `;

      setTimeout(() => {
        drawLineChart('pensionChart', years, years.map(y => pension.values[y] || 0), `${activeTab} Value (£)`, '#21d4fd');
      }, 50);

      document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();
        years.forEach(year => {
          const input = e.target[`val-${year}`];
          if (input) {
            pension.values[year] = parseFloat(input.value) || 0;
          }
        });
        localStorage.setItem('pensionDataV2', JSON.stringify(pensionData));
        render();
      });

      document.getElementById('addYearBtn').addEventListener('click', function() {
        const maxYear = Math.max(...years);
        const newYear = maxYear + 1;
        pension.values[newYear] = 0;
        localStorage.setItem('pensionDataV2', JSON.stringify(pensionData));
        render();
      });
    }

    render();
  </script>
</body>
</html>
